nohup: ignoring input
Federated Learning PEFine-Tuning for LLM:

model: alpaca
peft_method: lora
lora_r: 8
lora_alpha: 16
lora_dropout: 0.05
lora_target_modules: ['q_proj', 'k_proj', 'v_proj', 'o_proj']
num_virtual_tokens: 5
dataset: cola
dirichlet_alpha: 1
partition_method: dirichlet_label_uni
client_selection_strategy: random
client_selection_frac: 0.4
num_communication_rounds: 20
num_clients: 10
useFedProx: False
proximal_term_argument: 0.01
local_batch_size: 64
local_micro_batch_size: 16
local_learning_rate: 0.0003
local_val_set_size: 0
local_save_steps: 3
cutoff_len: 512
train_on_inputs: False
group_by_length: False
prompt_template_name: alpaca
local_num_epochs: 5
resume_from_checkpoint: False
peft: True
global_model: ./alpaca_native
data_path: ./data_download/GLUE/cola/CoLA/10-dirichlet_label_uni-1
output_dir: ./output
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:05<00:11,  5.99s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:12<00:06,  6.05s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:16<00:00,  5.30s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:16<00:00,  5.49s/it]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
trainable params: 8,388,608 || all params: 6,746,812,416 || trainable%: 0.12433438908285782
The process of federated instruction-tuning has started..
  0%|          | 0/65 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
/home/zikaixiao/anaconda3/envs/llm/lib/python3.8/site-packages/bitsandbytes/autograd/_functions.py:322: UserWarning: MatMul8bitLt: inputs will be cast from torch.float32 to float16 during quantization
  warnings.warn(f"MatMul8bitLt: inputs will be cast from {A.dtype} to float16 during quantization")
  2%|▏         | 1/65 [00:57<1:00:55, 57.11s/it]                                                  2%|▏         | 1/65 [00:57<1:00:55, 57.11s/it]  3%|▎         | 2/65 [01:46<55:26, 52.80s/it]                                                  3%|▎         | 2/65 [01:46<55:26, 52.80s/it]  5%|▍         | 3/65 [02:36<53:16, 51.56s/it]                                                5%|▍         | 3/65 [02:36<53:16, 51.56s/it]  6%|▌         | 4/65 [03:26<51:46, 50.92s/it]                                                6%|▌         | 4/65 [03:26<51:46, 50.92s/it]  8%|▊         | 5/65 [04:17<50:44, 50.74s/it]                                                8%|▊         | 5/65 [04:17<50:44, 50.74s/it]  9%|▉         | 6/65 [05:07<49:35, 50.43s/it]                                                9%|▉         | 6/65 [05:07<49:35, 50.43s/it] 11%|█         | 7/65 [05:56<48:26, 50.11s/it]                                               11%|█         | 7/65 [05:56<48:26, 50.11s/it] 12%|█▏        | 8/65 [06:46<47:24, 49.91s/it]                                               12%|█▏        | 8/65 [06:46<47:24, 49.91s/it] 14%|█▍        | 9/65 [07:35<46:33, 49.89s/it]                                               14%|█▍        | 9/65 [07:35<46:33, 49.89s/it] 15%|█▌        | 10/65 [08:26<45:50, 50.00s/it]                                                15%|█▌        | 10/65 [08:26<45:50, 50.00s/it] 17%|█▋        | 11/65 [09:16<45:00, 50.01s/it]                                                17%|█▋        | 11/65 [09:16<45:00, 50.01s/it] 18%|█▊        | 12/65 [10:06<44:11, 50.04s/it]                                                18%|█▊        | 12/65 [10:06<44:11, 50.04s/it] 20%|██        | 13/65 [10:56<43:21, 50.03s/it]                                                20%|██        | 13/65 [10:56<43:21, 50.03s/it] 22%|██▏       | 14/65 [11:37<40:14, 47.34s/it]                                                22%|██▏       | 14/65 [11:37<40:14, 47.34s/it] 23%|██▎       | 15/65 [12:27<40:03, 48.07s/it]                                                23%|██▎       | 15/65 [12:27<40:03, 48.07s/it] 25%|██▍       | 16/65 [13:17<39:42, 48.63s/it]                                                25%|██▍       | 16/65 [13:17<39:42, 48.63s/it] 26%|██▌       | 17/65 [14:07<39:16, 49.08s/it]                                                26%|██▌       | 17/65 [14:07<39:16, 49.08s/it] 28%|██▊       | 18/65 [14:57<38:40, 49.37s/it]                                                28%|██▊       | 18/65 [14:57<38:40, 49.37s/it] 29%|██▉       | 19/65 [15:47<37:58, 49.52s/it]                                                29%|██▉       | 19/65 [15:47<37:58, 49.52s/it] 31%|███       | 20/65 [16:37<37:14, 49.65s/it]                                                31%|███       | 20/65 [16:37<37:14, 49.65s/it] 32%|███▏      | 21/65 [17:26<36:21, 49.58s/it]                                                32%|███▏      | 21/65 [17:26<36:21, 49.58s/it] 34%|███▍      | 22/65 [18:15<35:26, 49.45s/it]                                                34%|███▍      | 22/65 [18:15<35:26, 49.45s/it] 35%|███▌      | 23/65 [19:05<34:39, 49.52s/it]                                                35%|███▌      | 23/65 [19:05<34:39, 49.52s/it] 37%|███▋      | 24/65 [19:55<34:00, 49.78s/it]                                                37%|███▋      | 24/65 [19:55<34:00, 49.78s/it] 38%|███▊      | 25/65 [20:46<33:16, 49.91s/it]                                                38%|███▊      | 25/65 [20:46<33:16, 49.91s/it] 40%|████      | 26/65 [21:36<32:27, 49.94s/it]                                                40%|████      | 26/65 [21:36<32:27, 49.94s/it] 42%|████▏     | 27/65 [22:17<29:58, 47.34s/it]                                                42%|████▏     | 27/65 [22:17<29:58, 47.34s/it] 43%|████▎     | 28/65 [23:06<29:36, 48.03s/it]                                                43%|████▎     | 28/65 [23:06<29:36, 48.03s/it] 45%|████▍     | 29/65 [23:56<29:06, 48.51s/it]                                                45%|████▍     | 29/65 [23:56<29:06, 48.51s/it] 46%|████▌     | 30/65 [24:46<28:29, 48.83s/it]                                                46%|████▌     | 30/65 [24:46<28:29, 48.83s/it] 48%|████▊     | 31/65 [25:35<27:49, 49.10s/it]                                                48%|████▊     | 31/65 [25:35<27:49, 49.10s/it] 49%|████▉     | 32/65 [26:25<27:09, 49.39s/it]                                                49%|████▉     | 32/65 [26:25<27:09, 49.39s/it] 51%|█████     | 33/65 [27:16<26:27, 49.60s/it]                                                51%|█████     | 33/65 [27:16<26:27, 49.60s/it] 52%|█████▏    | 34/65 [28:06<25:42, 49.75s/it]                                                52%|█████▏    | 34/65 [28:06<25:42, 49.75s/it] 54%|█████▍    | 35/65 [28:55<24:49, 49.67s/it]                                                54%|█████▍    | 35/65 [28:55<24:49, 49.67s/it] 55%|█████▌    | 36/65 [29:44<23:55, 49.51s/it]                                                55%|█████▌    | 36/65 [29:44<23:55, 49.51s/it] 57%|█████▋    | 37/65 [30:34<23:05, 49.46s/it]                                                57%|█████▋    | 37/65 [30:34<23:05, 49.46s/it] 58%|█████▊    | 38/65 [31:24<22:20, 49.65s/it]                                                58%|█████▊    | 38/65 [31:24<22:20, 49.65s/it] 60%|██████    | 39/65 [32:14<21:35, 49.84s/it]                                                60%|██████    | 39/65 [32:14<21:35, 49.84s/it] 62%|██████▏   | 40/65 [33:04<20:48, 49.96s/it]                                                62%|██████▏   | 40/65 [33:04<20:48, 49.96s/it] 63%|██████▎   | 41/65 [33:46<18:58, 47.45s/it]                                                63%|██████▎   | 41/65 [33:46<18:58, 47.45s/it] 65%|██████▍   | 42/65 [34:36<18:29, 48.23s/it]                                                65%|██████▍   | 42/65 [34:36<18:29, 48.23s/it] 66%|██████▌   | 43/65 [35:26<17:51, 48.69s/it]                                                66%|██████▌   | 43/65 [35:26<17:51, 48.69s/it] 68%|██████▊   | 44/65 [36:15<17:09, 49.01s/it]                                                68%|██████▊   | 44/65 [36:15<17:09, 49.01s/it] 69%|██████▉   | 45/65 [37:06<16:27, 49.37s/it]                                                69%|██████▉   | 45/65 [37:06<16:27, 49.37s/it] 71%|███████   | 46/65 [37:55<15:39, 49.46s/it]                                                71%|███████   | 46/65 [37:55<15:39, 49.46s/it] 72%|███████▏  | 47/65 [38:45<14:54, 49.68s/it]                                                72%|███████▏  | 47/65 [38:45<14:54, 49.68s/it] 74%|███████▍  | 48/65 [39:36<14:06, 49.81s/it]                                                74%|███████▍  | 48/65 [39:36<14:06, 49.81s/it] 75%|███████▌  | 49/65 [40:26<13:17, 49.86s/it]                                                75%|███████▌  | 49/65 [40:26<13:17, 49.86s/it] 77%|███████▋  | 50/65 [41:15<12:24, 49.60s/it]                                                77%|███████▋  | 50/65 [41:15<12:24, 49.60s/it] 78%|███████▊  | 51/65 [42:04<11:33, 49.51s/it]                                                78%|███████▊  | 51/65 [42:04<11:33, 49.51s/it] 80%|████████  | 52/65 [42:53<10:44, 49.56s/it]                                                80%|████████  | 52/65 [42:53<10:44, 49.56s/it] 82%|████████▏ | 53/65 [43:44<09:56, 49.71s/it]                                                82%|████████▏ | 53/65 [43:44<09:56, 49.71s/it] 83%|████████▎ | 54/65 [44:25<08:39, 47.22s/it]                                                83%|████████▎ | 54/65 [44:25<08:39, 47.22s/it] 85%|████████▍ | 55/65 [45:15<08:00, 48.03s/it]                                                85%|████████▍ | 55/65 [45:15<08:00, 48.03s/it] 86%|████████▌ | 56/65 [46:05<07:17, 48.62s/it]                                                86%|████████▌ | 56/65 [46:05<07:17, 48.62s/it] 88%|████████▊ | 57/65 [46:54<06:31, 48.91s/it]                                                88%|████████▊ | 57/65 [46:54<06:31, 48.91s/it] 89%|████████▉ | 58/65 [47:44<05:43, 49.12s/it]                                                89%|████████▉ | 58/65 [47:44<05:43, 49.12s/it] 91%|█████████ | 59/65 [48:34<04:55, 49.31s/it]                                                91%|█████████ | 59/65 [48:34<04:55, 49.31s/it] 92%|█████████▏| 60/65 [49:24<04:07, 49.42s/it]                                                92%|█████████▏| 60/65 [49:24<04:07, 49.42s/it] 94%|█████████▍| 61/65 [50:13<03:18, 49.58s/it]                                                94%|█████████▍| 61/65 [50:13<03:18, 49.58s/it] 95%|█████████▌| 62/65 [51:03<02:29, 49.70s/it]                                                95%|█████████▌| 62/65 [51:03<02:29, 49.70s/it] 97%|█████████▋| 63/65 [51:53<01:39, 49.77s/it]                                                97%|█████████▋| 63/65 [51:53<01:39, 49.77s/it] 98%|█████████▊| 64/65 [52:43<00:49, 49.62s/it]                                                98%|█████████▊| 64/65 [52:43<00:49, 49.62s/it]100%|██████████| 65/65 [53:32<00:00, 49.45s/it]                                               100%|██████████| 65/65 [53:32<00:00, 49.45s/it]                                               100%|██████████| 65/65 [53:32<00:00, 49.45s/it]100%|██████████| 65/65 [53:32<00:00, 49.42s/it]
{'loss': 12.6727, 'learning_rate': 0.0002953846153846154, 'epoch': 0.07}
{'loss': 11.7994, 'learning_rate': 0.00029076923076923073, 'epoch': 0.15}
{'loss': 11.1458, 'learning_rate': 0.00028615384615384614, 'epoch': 0.22}
{'loss': 10.6587, 'learning_rate': 0.0002815384615384615, 'epoch': 0.3}
{'loss': 10.4446, 'learning_rate': 0.0002769230769230769, 'epoch': 0.37}
{'loss': 10.4388, 'learning_rate': 0.0002723076923076923, 'epoch': 0.44}
{'loss': 9.8147, 'learning_rate': 0.0002676923076923077, 'epoch': 0.52}
{'loss': 9.583, 'learning_rate': 0.00026307692307692306, 'epoch': 0.59}
{'loss': 9.11, 'learning_rate': 0.00025846153846153846, 'epoch': 0.67}
{'loss': 8.9096, 'learning_rate': 0.0002538461538461538, 'epoch': 0.74}
{'loss': 8.857, 'learning_rate': 0.0002492307692307692, 'epoch': 0.81}
{'loss': 8.8159, 'learning_rate': 0.0002446153846153846, 'epoch': 0.89}
{'loss': 8.2442, 'learning_rate': 0.00023999999999999998, 'epoch': 0.96}
{'loss': 7.8966, 'learning_rate': 0.00023538461538461536, 'epoch': 1.04}
{'loss': 7.227, 'learning_rate': 0.00023076923076923076, 'epoch': 1.11}
{'loss': 6.7953, 'learning_rate': 0.00022615384615384614, 'epoch': 1.19}
{'loss': 6.6156, 'learning_rate': 0.00022153846153846152, 'epoch': 1.26}
{'loss': 6.3327, 'learning_rate': 0.0002169230769230769, 'epoch': 1.33}
{'loss': 6.2211, 'learning_rate': 0.0002123076923076923, 'epoch': 1.41}
{'loss': 6.3618, 'learning_rate': 0.00020769230769230766, 'epoch': 1.48}
{'loss': 6.0876, 'learning_rate': 0.00020307692307692306, 'epoch': 1.56}
{'loss': 6.2258, 'learning_rate': 0.00019846153846153844, 'epoch': 1.63}
{'loss': 5.8181, 'learning_rate': 0.00019384615384615385, 'epoch': 1.7}
{'loss': 5.7668, 'learning_rate': 0.0001892307692307692, 'epoch': 1.78}
{'loss': 5.7494, 'learning_rate': 0.0001846153846153846, 'epoch': 1.85}
{'loss': 5.3991, 'learning_rate': 0.00017999999999999998, 'epoch': 1.93}
{'loss': 5.6702, 'learning_rate': 0.0001753846153846154, 'epoch': 2.0}
{'loss': 5.4375, 'learning_rate': 0.00017076923076923074, 'epoch': 2.07}
{'loss': 5.342, 'learning_rate': 0.00016615384615384615, 'epoch': 2.15}
{'loss': 5.4696, 'learning_rate': 0.00016153846153846153, 'epoch': 2.22}
{'loss': 5.1018, 'learning_rate': 0.0001569230769230769, 'epoch': 2.3}
{'loss': 5.5032, 'learning_rate': 0.00015230769230769228, 'epoch': 2.37}
{'loss': 5.0782, 'learning_rate': 0.0001476923076923077, 'epoch': 2.44}
{'loss': 5.2539, 'learning_rate': 0.00014307692307692307, 'epoch': 2.52}
{'loss': 4.7362, 'learning_rate': 0.00013846153846153845, 'epoch': 2.59}
{'loss': 5.0946, 'learning_rate': 0.00013384615384615385, 'epoch': 2.67}
{'loss': 5.0498, 'learning_rate': 0.00012923076923076923, 'epoch': 2.74}
{'loss': 5.0611, 'learning_rate': 0.0001246153846153846, 'epoch': 2.81}
{'loss': 5.004, 'learning_rate': 0.00011999999999999999, 'epoch': 2.89}
{'loss': 5.1826, 'learning_rate': 0.00011538461538461538, 'epoch': 2.96}
{'loss': 4.619, 'learning_rate': 0.00011076923076923076, 'epoch': 3.04}
{'loss': 4.6627, 'learning_rate': 0.00010615384615384615, 'epoch': 3.11}
{'loss': 4.8774, 'learning_rate': 0.00010153846153846153, 'epoch': 3.19}
{'loss': 4.956, 'learning_rate': 9.692307692307692e-05, 'epoch': 3.26}
{'loss': 4.7631, 'learning_rate': 9.23076923076923e-05, 'epoch': 3.33}
{'loss': 4.7126, 'learning_rate': 8.76923076923077e-05, 'epoch': 3.41}
{'loss': 4.6944, 'learning_rate': 8.307692307692307e-05, 'epoch': 3.48}
{'loss': 4.4731, 'learning_rate': 7.846153846153845e-05, 'epoch': 3.56}
{'loss': 4.7656, 'learning_rate': 7.384615384615384e-05, 'epoch': 3.63}
{'loss': 4.7992, 'learning_rate': 6.923076923076922e-05, 'epoch': 3.7}
{'loss': 4.6162, 'learning_rate': 6.461538461538462e-05, 'epoch': 3.78}
{'loss': 4.6215, 'learning_rate': 5.9999999999999995e-05, 'epoch': 3.85}
{'loss': 4.8859, 'learning_rate': 5.538461538461538e-05, 'epoch': 3.93}
{'loss': 4.5664, 'learning_rate': 5.0769230769230766e-05, 'epoch': 4.0}
{'loss': 4.582, 'learning_rate': 4.615384615384615e-05, 'epoch': 4.07}
{'loss': 4.7256, 'learning_rate': 4.153846153846154e-05, 'epoch': 4.15}
{'loss': 4.4402, 'learning_rate': 3.692307692307692e-05, 'epoch': 4.22}
{'loss': 4.7541, 'learning_rate': 3.230769230769231e-05, 'epoch': 4.3}
{'loss': 4.4372, 'learning_rate': 2.769230769230769e-05, 'epoch': 4.37}
{'loss': 4.5498, 'learning_rate': 2.3076923076923076e-05, 'epoch': 4.44}
{'loss': 4.2689, 'learning_rate': 1.846153846153846e-05, 'epoch': 4.52}
{'loss': 4.5965, 'learning_rate': 1.3846153846153845e-05, 'epoch': 4.59}
{'loss': 4.5879, 'learning_rate': 9.23076923076923e-06, 'epoch': 4.67}
{'loss': 4.6051, 'learning_rate': 4.615384615384615e-06, 'epoch': 4.74}
{'loss': 4.4899, 'learning_rate': 0.0, 'epoch': 4.81}
{'train_runtime': 3212.2144, 'train_samples_per_second': 1.326, 'train_steps_per_second': 0.02, 'train_loss': 6.185022119375375, 'epoch': 4.81}
Total training time: 0:53:32
Save successfully!
